#
#
# dist.boot.temp <- function(y.boot, x.boot, boot.tpval, ...){
#   is.boot <- isat(y.boot, mxreg=x.boot, mc=FALSE, t.pval=boot.tpval, iis=TRUE, sis=FALSE,  print.searchinfo=FALSE, ...)
#   dist.boot <- distorttest(is.boot)
#   out.boot <- outliertest(is.boot)
#   dist.res <- c(dist.boot$coef.diff, dist.boot$statistic,  out.boot$proportion$estimate,  out.boot$proportion$statistic, out.boot$count$estimate, out.boot$count$statistic)
#   names(dist.res) <- c(names(dist.boot$coef.diff), "dist", "prop", "prop.test", "count", "count.test")
#   return( dist.res)
# }
#
#

a <- structure(c(-1.12153060750057, 1.12031577458354, -3.33369475420723,
            2.45463032149154, 2.19588626605266, 0.991343996639418, -1.36406180858942,
            -2.85343838732114, -4.84864861574378, -2.12629390833256, 2.01964792786163,
            0.858908696764976, -0.498264931695488, 1.6271519975933, 0.495370010425212,
            -1.96789562360942, 1.31195175504991, 2.98671914205256, 1.54906998359156,
            -0.0305489515203464, -0.669715191336759, 1.79543594952104, -0.953481637405758,
            0.902340430572454, 0.706472866924461, 6.52237680168813, 1.44773981622153,
            0.147714272852977, 2.2183403767594, -1.51945542275926, 1.0255713696967,
            -0.284773007051009, -1.22071771225454, 0.18130347974915, -0.138891362439045,
            0.00576418589988693, 0.38528040112633, -0.370660031792409, 0.644376548518833,
            -0.220486561818751, 0.331781963915697, 1.09683901314935, 0.435181490833803,
            -0.325931585531227, 1.14880761845109, 0.993503855962119, 0.54839695950807,
            0.238731735111441, -0.627906076039371, 1.36065244853001, -0.600259587147127,
            2.18733299301658, 1.53261062618519, -0.235700359100477, -1.02642090030678,
            -0.710406563699301, 0.25688370915653, -0.246691878462374, -0.347542599397733,
            -0.951618567265016, -0.784904469457076, -1.66794193658814, -0.380226520287762,
            0.918996609060766, -0.575346962608392, 0.607964322225033, -1.61788270828916,
            -0.0555619655245394, 0.519407203943462, 0.301153362166714, 0.105676194148943,
            -0.640706008305376, -0.849704346033582, -1.02412879060491, 0.117646597100126,
            -0.947474614184802, -0.490557443700668, -0.256092192198247, 1.84386200523221,
            -0.651949901695459, 0.235386572284857, 0.0779608495637108, -0.961856634130129,
            -0.0713080861235987, 1.44455085842335, 0.451504053079215, 0.0412329219929399,
            -0.422496832339625, -2.05324722154052, 1.13133721341418, 0.739947510877334,
            1.90910356921748, -1.4438931609718, 0.701784335374711, -0.262197489402468,
            -1.57214415914549, -1.51466765378175, -1.60153617357459, -0.530906522170303,
            -1.4617555849959, 0.687916772975828, 2.10010894052567, -1.28703047603518,
            0.787738847475178, 0.76904224100091, 0.332202578950118, -1.00837660827701,
            -0.119452606630659, -0.280395335170247, 0.56298953322048, -0.372438756103829,
            0.976973386685621, -0.374580857767014, 1.05271146557933, -1.04917700666607,
            -1.26015524475811, 3.2410399349424, -0.416857588160432, 0.298227591540715,
            0.636569674033849, 0.516862044313609, 0.368964527385086, -0.215380507641693,
            0.0652930335253153, -0.034067253738464, 2.12845189901618, -0.741336096272828,
            -1.09599626707466, 0.0377883991710788, 0.310480749443137, 0.436523478910183,
            -0.458365332711106, -1.06332613397119, 1.26318517608949, -0.349650387953555,
            -0.865512862653374, -0.236279568941097, -0.197175894348552, 1.10992028971364,
            0.0847372921971965, 0.754053785184521, -0.499292017172261, 0.214445309581601,
            -0.324685911490835, 0.0945835281735714, -0.895363357977542, -1.31080153332797,
            1.99721338474797, 0.600708823672418, -1.25127136162494, -1.18548008459731,
            2.19881034888372, 1.31241297643351, -0.265145056696353, 0.54319405923209,
            -0.41433994791886, -0.476246894615578, -0.788602837850243, -0.594617267459511,
            1.65090746733669, -0.0540281250854405, 0.119245236427584, 0.243687429599092,
            1.23247587848534, -0.51606383094478, -0.992507150392037, 1.67569693240319,
            -0.441163216905286, -0.723065969939874, -1.23627311888329, -1.2847157223178,
            -0.573973479297987, 0.617985817166529, 1.10984813892972, 0.707588353835588,
            -0.363657297095253, 0.0597499373846007, -0.70459646368007, -0.71721816157401,
            0.88465049897692), .Dim = c(30L, 6L), .Dimnames = list(NULL,
                                                                   c("y", "x1", "x2", "x3", "x4", "x5")), .Tsp = c(1, 30, 1), class = c("mts",
                                                                                                                                        "ts", "matrix"))

a <- as.ts(data.frame(y = y_x, mx))


boot.tpval <- p_alpha*scale.t.pval #bootstrap level of significance of selection

boot.tpval <- 0.05

stat <- function(tsb, t.pval, boot.tpval, max.block.size,p_alpha){
  y.boot <- tsb[,1]
  x.boot <- tsb[,2:ncol(tsb)]

  is.boot <- isat(y.boot, mxreg=x.boot, mc=FALSE, t.pval=boot.tpval, iis=TRUE, sis=FALSE,  print.searchinfo=FALSE, max.block.size = max.block.size)
  dist.boot <- distorttest(is.boot)
  out.boot <- outliertest(is.boot)
  dist.res <- c(dist.boot$coef.diff, dist.boot$statistic,  out.boot$proportion$estimate,  out.boot$proportion$statistic, out.boot$count$estimate, out.boot$count$statistic)
  names(dist.res) <- c(names(dist.boot$coef.diff), "dist", "prop", "prop.test", "count", "count.test")
  return( dist.res)

}

test <- tsboot(tseries = a, statistic = stat,R = 5, l = 3, sim = "fixed",
               boot.tpval = 0.05,#specs$boot.pval.scale[j],
               max.block.size=2)

b <- test$t
colnames(b) <- c(colnames(a)[-1], "dist", "prop", "prop.test", "count", "count.test")
test$t


